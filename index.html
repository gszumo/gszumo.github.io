<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="main.css" type="text/css" />
<link rel="stylesheet" href="blog.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="Subscribe to this page..." href="feed.rss" />
<title>Gregg's MOTD</title>
</head><body>
<div id="divbodyholder">
<div class="headerholder"><div class="header">
<div id="title">
<h1 class="nomargin"><a class="ablack" href="http://www.szumowski.org/index.html">Gregg's MOTD</a></h1>
<div id="description">Tips & Tricks that I've Encountered Over the Years...</div>
</div></div></div>
<div id="divbody"><div class="content">
<h3><a class="ablack" href="creating-a-docker-registry8450.html">
Creating a Docker Registry
</a></h3>
<!-- bashblog_timestamp: #202307281948.04# -->
<div class="subtitle">July 28, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>Creating a docker registry is rather straightforward, but you may
need to do some <em>tweaking</em> of your docker installation in order
to get it working as indicated below.</p>
<p>Let’s assume that you already have docker up and running on your
machine.</p>
<p>We are going to set up a Docker registry on our local server. This
server will not have a secure connection and will only be used
internally, so we will need to allow this access by creating a file in
<code>/etc/docker</code> called <em>daemon.json</em> to designate
this:</p>
<blockquote>
<p><code>{</code><br/> <code>"insecure-registries":[</code><br/>
<code>"localhost:5000"</code><br/> <code>]</code><br/>
<code>}</code><br/></p>
</blockquote>
<p>Don’t forget to restart the docker daemon after making this
change.</p>
<p>Now, create a docker volume that will persist your registry data when
it goes offline:</p>
<blockquote>
<p><code># docker volume create /mnt/registry</code><br/></p>
</blockquote>
<p>This next part is optional. You can use whatever means you want to
download and start the container: Create a script to download the image
and start the container:</p>
<blockquote>
<p><code># mkdir /mnt/registry</code><br/>
<code># cat &gt;start-registry.sh &lt;&lt;"EOF"</code><br/>
<code>&gt; docker run -d \</code><br/>
<code>&gt;   -p 5000:5000 \</code><br/>
<code>&gt;   --restart=always \</code><br/>
<code>&gt;   --name registry \</code><br/>
<code>&gt;   -v /mnt/registry:/var/lib/registry \</code><br/>
<code>&gt;   registry:2</code><br/> <code>&gt; EOF</code><br/></p>
</blockquote>
<p>Now start the registry (using the above script):</p>
<blockquote>
<p><code># ./start-registry.sh</code><br/></p>
</blockquote>
<p>Now, let’s test it by pushing a sample <em>hello-world</em> image to
the registry:</p>
<blockquote>
<p><code>$ docker tag hello-world:latest localhost:5000/hello-world:latest</code><br/>
<code>$ docker push localhost:5000/hello-world:latest</code><br/>
<code>The push refers to repository [localhost:5000/hello-world]</code><br/>
<code>e07ee1baac5f: Pushed</code><br/>
<code>latest: digest: sha256:f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4 size: 525</code><br/></p>
</blockquote>
<p>NOTE: If you are pushing to this registry from another server you
need to add the following to <code>/etc/docker/daemon.json</code> and
restart <em>docker</em> before you will be able to do a <em>push</em>
(replace <em>localhost</em> with the IP address of the server that’s
running the registry):</p>
<blockquote>
<p><code>{</code><br/> <code>"insecure-registries":[</code><br/>
<code>"localhost:5000"</code><br/> <code>]</code><br/>
<code>}</code><br/></p>
</blockquote>
<p>Now we can use <em>curl</em> to list the repositories in the
registry:</p>
<blockquote>
<p><code>curl localhost:5000/v2/_catalog</code><br/></p>
</blockquote>
<p>More information about creating a <em>docker registry</em> can be
found <a
href="https://www.tutorialspoint.com/docker/docker_private_registries.htm">here</a>
and if you’re interested in setting up authentication for your private
registry you can find more information <a
href="https://www.baeldung.com/ops/docker-private-registry">here</a></p>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_docker.html'>docker</a>, <a href='tag_registry.html'>registry</a>, <a href='tag_motd.html'>motd</a></p>
<!-- text end -->
<h3><a class="ablack" href="using-rsync-to-sync-two-directories17585.html">
Using rsync to Sync Two Directories
</a></h3>
<!-- bashblog_timestamp: #202307271709.20# -->
<div class="subtitle">July 27, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>You can sync two directories using <em>rsync</em> tool. The following
command:</p>
<blockquote>
<p><code>$ rsync -a -v --delete sending_directory target_directory;</code><br/></p>
</blockquote>
<p>will copy <em>sending_directory</em> to <em>target_directory</em>
creating a directory structure of
<em>sending_directory/target_directory</em>. The <code>--delete</code>
flag will ensure that any files that were previously in
<em>sending_directory/target_directory</em> that are not in
<em>sending_directory</em> will be deleted so that the contents of the
two directories are the same.</p>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_rsync.html'>rsync</a>, <a href='tag_backups.html'>backups</a>, <a href='tag_motd.html'>motd</a></p>
<!-- text end -->
<h3><a class="ablack" href="move-files-older-than-so-many-days-with-find.html">
Move Files Older Than So Many Days with Find
</a></h3>
<!-- bashblog_timestamp: #202307261708.26# -->
<div class="subtitle">July 26, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>You may want to clean up a directory that has files older than a
certain number of days, for example, 30 days. You can do this with the
<em>find</em> command:</p>
<p>To move files older than 30 days in current folder to the
<em>old</em> folder:</p>
<blockquote>
<p><code>$ find . -mtime +30 -exec mv {} old/ \;</code><br/></p>
</blockquote>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_find.html'>find</a>, <a href='tag_mtime.html'>mtime</a>, <a href='tag_mv.html'>mv</a>, <a href='tag_motd.html'>motd</a></p>
<!-- text end -->
<h3><a class="ablack" href="build-tag-and-push-a-docker-image-with-one-command.html">
Build, Tag, and Push a Docker Image with One Command
</a></h3>
<!-- bashblog_timestamp: #202307251732.36# -->
<div class="subtitle">July 25, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>You can build, tag, and push a docker image to a remote all in one
command with the –quiet parameter on docker build, which only outputs
the SHA256 hash (annoyingly prefixed with SHA256:, but nothing a little
cutting can’t fix).</p>
<blockquote>
<p><code>$ docker tag $(docker build . -q | cut -c 8-999) myregid/imagename:1.0.1 &amp;&amp; docker push myregid/imagename</code><br/></p>
</blockquote>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_docker.html'>docker</a>, <a href='tag_motd.html'>motd</a></p>
<!-- text end -->
<h3><a class="ablack" href="vim-tips-searching-a-file-for-multiple-strings.html">
Vim Tips: Searching a File for Multiple Strings
</a></h3>
<!-- bashblog_timestamp: #202307242035.18# -->
<div class="subtitle">July 24, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>In Vim you can perform a search like this: /string1/;/string2</p>
<p>This will will combine two searches. It tells Vim:</p>
<ol type="1">
<li>Search for string1, then</li>
<li>From there search for string2 on any line that also contains
string1.</li>
</ol>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_vim.html'>vim</a>, <a href='tag_search.html'>search</a>, <a href='tag_motd.html'>motd</a></p>
<!-- text end -->
<h3><a class="ablack" href="using-rclone-to-mount-your-onedrive-folder-in-linux4329.html">
Using RClone to Mount Your OneDrive Folder in Linux
</a></h3>
<!-- bashblog_timestamp: #202307231626.09# -->
<div class="subtitle">July 23, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>If you have a Microsoft Office 365 account you know that it comes
with 1TB of storage. You can use <em>RClone</em> to mount your
<em>OneDrive</em> locally on your Linux machine so that you can read and
write documents stored there.</p>
<ol type="1">
<li>Install <em>rclone</em> from whatever package repository that your
Linux operating system uses.</li>
<li>Follow the instructions <a
href="https://rclone.org/onedrive/">here</a> to configure your
<em>OneDrive</em> environment. The instructions are rather
straightforward and a couple pieces of extra advice follows:</li>
</ol>
<p>In the first section, type <code>n</code> for a <em>new</em>
installation and give your mountpoint a name:</p>
<blockquote>
<p><code>$ rclone config</code><br/>
<code>No remotes found - make a new one</code><br/>
<code>n) New remote</code><br/>
<code>s) Set configuration password</code><br/>
<code>q) Quit config</code><br/>
<code>n/s/q&gt;</code>n<code></code><br/>
<code>name&gt; remote</code><br/></p>
</blockquote>
<p>In the next section just press enter to accept the default:</p>
<blockquote>
<p><code>Type of storage to configure.</code><br/>
<code>Enter a string value. Press Enter for the default ("").</code><br/></p>
</blockquote>
<p>Now you have to choose the <em>vendor</em> of the service you’re
configuring. There are a lot of selections hereso just look for
<em>Microsoft OneDrive</em>, in my case it was <em>26</em>:</p>
<blockquote>
<p><code>Choose a number from below, or type in your own value</code><br/>
<code>1 / 1Fichier</code><br/> <code>\ "fichier"</code><br/>
<code>2 / Alias for an existing remote</code><br/>
<code>\ "alias"</code><br/> <code>etc.</code><br/>
<code>25 / Microsoft Azure Blob Storage</code><br/>
<code>\ "azureblob"</code><br/>
<code>26 / Microsoft OneDrive</code><br/> <code>\ "onedrive"</code><br/>
<code>27 / OpenDrive</code><br/> <code>\ "opendrive"</code><br/>
<code>28 / OpenStack Swift (Rackspace Cloud Files, Memset Memstore, OVH)</code><br/>
<code>\ "swift"</code><br/> <code>Storage&gt; 26</code><br/></p>
</blockquote>
<p>The next couple of selections are just the default, so press the
<em>Enter</em> key:</p>
<blockquote>
<p><code>OAuth Client Id</code><br/>
<code>Leave blank normally.</code><br/>
<code>Enter a string value. Press Enter for the default ("").</code><br/>
<code>client_id&gt;</code><br/> <code>OAuth Client Secret</code><br/>
<code>Leave blank normally.</code><br/>
<code>Enter a string value. Press Enter for the default ("").</code><br/>
<code>client_secret&gt;</code><br/></p>
</blockquote>
<p>Now select the <em>global</em> choice:</p>
<blockquote>
<p><code>Choose national cloud region for OneDrive.</code><br/>
<code>Enter a string value. Press Enter for the default ("global").</code><br/>
<code>Choose a number from below, or type in your own value</code><br/>
<code>1 / Microsoft Cloud Global</code><br/>
<code>\ "global"</code><br/>
<code>2 / Microsoft Cloud for US Government</code><br/>
<code>\ "us"</code><br/> <code>3 / Microsoft Cloud Germany</code><br/>
<code>\ "de"</code><br/>
<code>4 / Azure and Office 365 operated by 21Vianet in China</code><br/>
<code>\ "cn"</code><br/> <code>region&gt; 1</code><br/></p>
</blockquote>
<p>Select the <em>default</em> here:</p>
<blockquote>
<p><code>Edit advanced config? (y/n)</code><br/>
<code>y) Yes</code><br/> <code>n) No (default)</code><br/>
<code>y/n&gt; n</code><br/></p>
</blockquote>
<p>Select the <em>default</em> here:</p>
<blockquote>
<p><code>Remote config</code><br/> <code>Use auto config?</code><br/>
<code>* Say Y if not sure</code><br/>
<code>* Say N if you are working on a remote or headless machine</code><br/>
<code>y) Yes (default)</code><br/> <code>n) No</code><br/>
<code>y/n&gt; y</code><br/></p>
</blockquote>
<p>Now the browser should open and you should provide your Microsoft
credentials:</p>
<blockquote>
<p><code>If your browser doesn't open automatically go to the following link: http://127.0.0.1:53682/auth?state=&lt;some long key here&gt;</code><br/>
<code></code><br/>
<code>Log in and authorize rclone for access</code><br/>
<code>Waiting for code...</code><br/> <code>Got code</code><br/></p>
</blockquote>
<p>Select <em>1</em> for <em>Personal or Business</em>:</p>
<blockquote>
<p><code>Choose a number from below, or type in an existing value</code><br/>
<code>1 / OneDrive Personal or Business</code><br/>
<code>\ "onedrive"</code><br/>
<code>2 / Root Sharepoint site</code><br/>
<code>\ "sharepoint"</code><br/>
<code>3 / Sharepoint site name or URL (e.g. mysite or https://contoso.sharepoint.com/sites/mysite)</code><br/>
<code>\ "url"</code><br/>
<code>4 / Search for a Sharepoint site</code><br/>
<code>\ "search"</code><br/>
<code>5 / Type in driveID (advanced)</code><br/>
<code>\ "driveid"</code><br/>
<code>6 / Type in SiteID (advanced)</code><br/>
<code>\ "siteid"</code><br/>
<code>7 / Sharepoint server-relative path (advanced, e.g. /teams/hr)</code><br/>
<code>\ "path"</code><br/> <code>Your choice&gt; 1</code><br/></p>
</blockquote>
<p>Select the drive number from the list, there will probably be only
one to choose from, and then select the default:</p>
<blockquote>
<p><code>Found 1 drives, please select the one you want to use:</code><br/>
<code>0:  (personal) id=&lt;id key&gt;</code><br/>
<code>Chose drive to use:&gt; 0</code><br/>
<code>Found drive 'root' of type 'personal', URL: https://onedrive.live.com/?cid=&lt;id key&gt;</code><br/>
<code>Is that okay?</code><br/> <code>y) Yes (default)</code><br/>
<code>n) No</code><br/> <code>y/n&gt; y</code><br/></p>
</blockquote>
<p>Now <em>rclone</em> will list out the configuration information and
ask for confirmation. If all looks good then select <em>y</em> and
you’re done:</p>
<blockquote>
<p><code>--------------------</code><br/> <code>[remote]</code><br/>
<code>type = onedrive</code><br/> <code>region = global</code><br/>
<code>token = &lt;some long token string here&gt;</code><br/>
<code></code><br/>
<code>drive_id = &lt;some long token string here&gt;</code><br/>
<code></code><br/> <code>drive_type = personal</code><br/>
<code>--------------------</code><br/>
<code>y) Yes this is OK (default)</code><br/>
<code>e) Edit this remote</code><br/>
<code>d) Delete this remote</code><br/> <code>y/e/d&gt; y</code><br/>
<code>Current remotes:</code><br/> <code></code><br/>
<code>Name                 Type</code><br/>
<code>====                 ====</code><br/>
<code>remote               onedrive</code><br/> <code></code><br/>
<code>e) Edit existing remote</code><br/>
<code>n) New remote</code><br/> <code>d) Delete remote</code><br/>
<code>r) Rename remote</code><br/> <code>c) Copy remote</code><br/>
<code>s) Set configuration password</code><br/>
<code>q) Quit config</code><br/>
<code>e/n/d/r/c/s/q&gt; q</code><br/></p>
</blockquote>
<ol start="3" type="1">
<li>Now you should be able to list the contents of the OneDrive
directory on the console:</li>
</ol>
<blockquote>
<p><code>$ rclone lsd remote:</code><br/>
<code>-1 2023-06-23 04:15:30         3 .Trash-1000</code><br/>
<code>-1 2023-07-23 15:21:03         1 Apps</code><br/>
<code>-1 2017-09-20 15:34:22         0 Attachments</code><br/>
<code>-1 2023-07-04 23:53:04         0 Desktop</code><br/>
<code>-1 2023-07-23 14:33:10       472 Documents</code><br/>
<code>-1 2023-07-22 02:43:07       135 Documents from Macbook</code><br/>
<code>-1 2019-11-08 21:22:23         0 Email attachments</code><br/>
<code>-1 2019-11-08 21:22:23         0 Movies</code><br/>
<code>-1 2023-07-23 03:39:57        53 Music</code><br/>
<code>-1 2023-07-02 16:34:04        37 Pictures</code><br/>
<code>-1 2022-05-24 10:39:02         2 Public</code><br/>
<code>-1 2021-08-01 13:47:30         2 SyncFusion</code><br/>
<code>-1 2023-06-20 11:41:24         4 Videos</code><br/></p>
</blockquote>
<p>If for some reason it isn’t mounted you can mount it manually with
the following command:</p>
<blockquote>
<p><code>$ rclone --vfs-cache-mode writes mount remote: ~/OneDrive &amp;</code><br/>
<code>[2] 69267</code><br/></p>
</blockquote>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_rclone.html'>rclone</a>, <a href='tag_onedrive.html'>onedrive</a>, <a href='tag_motd.html'>motd</a></p>
<!-- text end -->
<h3><a class="ablack" href="how-to-find-the-ip-addresses-of-virtual-machines-from-the-command.html">
Find the IP Addresses of KVM Virtual Machines (Command Line)
</a></h3>
<!-- bashblog_timestamp: #202307221540.26# -->
<div class="subtitle">July 22, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>To find details about the virtual network you can use these
commands:</p>
<blockquote>
<p><code>root@slacker:~# virsh net-list</code><br/>
<code>Name      State    Autostart   Persistent</code><br/>
<code>--------------------------------------------</code><br/>
<code>default   active   yes         yes</code><br/> <code></code><br/>
<code>root@slacker:~# virsh net-info default</code><br/>
<code>Name:           default</code><br/>
<code>UUID:           14a90f27-9a85-42ca-b434-6ce6c142690c</code><br/>
<code>Active:         yes</code><br/>
<code>Persistent:     yes</code><br/>
<code>Autostart:      yes</code><br/>
<code>Bridge:         virbr0</code><br/> <code></code><br/>
<code>root@slacker:~# virsh net-dhcp-leases default</code><br/>
<code>Expiry Time           MAC address         Protocol   IP address           Hostname      Client ID or DUID</code><br/>
<code>------------------------------------------------------------------------------------------------------------</code><br/>
<code>2023-07-22 16:18:45   52:54:00:dd:7b:62   ipv4       192.168.122.216/24   centos7-bbk   -</code><br/>
<code></code><br/></p>
</blockquote>
<p>You will find the IP address and hostname listed in the last
command’s output.</p>
<p>Optionally, to find the network interfaces’s addresses for a running
domain called <em>centos7-bbk</em>:</p>
<blockquote>
<p><code>root@slacker:~# virsh list</code><br/>
<code>Id   Name          State</code><br/>
<code>-----------------------------</code><br/>
<code>3    centos7-bbk   running</code><br/> <code></code><br/>
<code>root@slacker:~# virsh domifaddr centos7-bbk</code><br/>
<code>Name       MAC address          Protocol     Address</code><br/>
<code>-------------------------------------------------------------------------------</code><br/>
<code>vnet2      52:54:00:dd:7b:62    ipv4         192.168.122.216/24</code><br/>
<code></code><br/> <code>root@slacker:~#</code><br/></p>
</blockquote>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_kvm.html'>kvm</a>, <a href='tag_virsh.html'>virsh</a>, <a href='tag_networking.html'>networking</a>, <a href='tag_motd.html'>motd</a></p>

<!-- text end -->
<h3><a class="ablack" href="ssh-escape-sequences24826.html">
SSH Escape Sequences
</a></h3>
<!-- bashblog_timestamp: #202307211705.54# -->
<div class="subtitle">July 21, 2023 &mdash; 
Gregg Szumowski
</div>
<!-- text begin -->
<p>Have you ever had an SSH connection timeout on you and you’re left
with what looks like a locked session. Repeatedly hitting the
<em>Enter</em> key does nothing. It seems that there is nothing that you
can do except close the console terminal session…or is there something
else?</p>
<p>Many people are not aware that SSH has its own set of keyboard
shortcuts. The solution to the above problem is to terminate the
connection using the first of these shortcuts.</p>
<ol type="1">
<li>Press the <em>Enter</em> key.</li>
<li>Press the <em>tilde</em> followed by a <em>period</em>.</li>
<li>Press <em>Enter</em> again. You should now be back at your command
prompt.</li>
</ol>
<p>Supported escape sequences:<br/> <code>~.</code> - terminate
connection (and any multiplexed sessions)<br/> <code>~B</code> - send a
BREAK to the remote system<br/> <code>~R</code> - request rekey<br/>
<code>~V/v</code> - decrease/increase verbosity (LogLevel)<br/>
<code>~^Z</code> - suspend ssh<br/> <code>~#</code> - list forwarded
connections<br/> <code>~&amp;</code> - background ssh (when waiting for
connections to terminate)<br/> <code>~?</code> - this message<br/>
<code>~~</code> - send the escape character by typing it twice<br/>
(Note that escapes are only recognized immediately after newline.)</p>
<p>It is important to note that you always press the <em>Enter</em> key
before typing the key sequences above.</p>
<p>Tags: <a href='tag_cli.html'>cli</a>, <a href='tag_ssh.html'>ssh</a>, <a href='tag_shortcuts.html'>shortcuts</a>, <a href='tag_motd.html'>motd</a></p>

<!-- text end -->
<div id="all_posts"><a href="all_posts.html">View more posts</a> &mdash; <a href="all_tags.html">All tags</a> &mdash; <a href="feed.rss">Subscribe</a></div>
</div>
<div id="footer">CC by-nc-nd <a href="http://twitter.com/gszumo">Gregg Szumowski</a> &mdash; <a href="mailto:gszumo[at]gmail[dot]com">gszumo[at]gmail[dot]com</a> &mdash; <a rel="me" href="https://mastodon.sdf.org/@gszumo">Mastodon</a><br/>
NOTE: All tips provided are USE AT YOUR OWN RISK. It is suggested that you read and test each tip in a non-volitile environment before placing into production.<br/>
Generated with <a href="https://github.com/cfenollosa/bashblog">bashblog</a>, a single bash script to easily create blogs like this one</div>
</div></div>
</body></html>
